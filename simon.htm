<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Simon Says</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.1/angular.min.js"></script>
    <style>
        .circle {
            width: 400px;
            height: 400px;
            border-radius: 50%;
            border: solid 1px gray;
        }
        .inside {
            margin: 5px;
            width: 388px;
            height: 388px;
        }
        .controls {
            margin: 109px;
            width: 168px;
            height: 168px;
        }
        .start {
            margin: 70px;
            text-align: center;
            cursor: pointer;
        }
        .lense {
            position: absolute;
            width: 120px;
            height: 75px;
            border: solid 1px #666;
            cursor: pointer;
        }
        .green {
            background: rgb(0,170,0);
            top: 70px;
            left: 60px;
            -ms-transform: rotate(-45deg); /* IE 9 */
            -webkit-transform: rotate(-45deg); /* Chrome, Safari, Opera */
            transform: rotate(-45deg);
        }
        .red {
            background: rgb(205,0,0);
            top: 70px;
            left: 245px;
            -ms-transform: rotate(45deg); /* IE 9 */
            -webkit-transform: rotate(45deg); /* Chrome, Safari, Opera */
            transform: rotate(45deg);
        }
        .blue {
            background: rgb(20,20,205);
            top: 265px;
            left: 60px;
            -ms-transform: rotate(45deg); /* IE 9 */
            -webkit-transform: rotate(45deg); /* Chrome, Safari, Opera */
            transform: rotate(45deg);
        }
        .yellow {
            background: rgb(205,205,0);
            top: 265px;
            left: 245px;
            -ms-transform: rotate(-45deg); /* IE 9 */
            -webkit-transform: rotate(-45deg); /* Chrome, Safari, Opera */
            transform: rotate(-45deg);
        }
        .brighten {
            filter: brightness(2.5);
        }
    </style>
    <!--<audio id="buttonSound1" src="assets/button1.wav" autostart="false" preload="auto" ></audio>
    <audio id="buttonSound2" src="assets/button2.wav" autostart="false" preload="auto" ></audio>
    <audio id="buttonSound3" src="assets/button3.wav" autostart="false" preload="auto" ></audio>
    <audio id="buttonSound4" src="assets/button4.wav" autostart="false" preload="auto" ></audio>
    <audio id="audiosource" src="assets/button4.wav" autostart="false" preload="auto" ></audio>-->
    <script>
        var simonApp = angular.module('simonApp', []);
        simonApp.controller('myCtrl', function($scope, $timeout) {

            $scope.gameStarted = false;
            var sound1 = angular.element(document.querySelector( '#buttonSound1' ) );

            $scope.buttonPress = function (button,num) {
                if ($scope.gameStarted) {
                    playSound(num);
                    $scope.lightButton(button);
                }
            };

            $scope.lightButton = function (lense){
                var myEl = angular.element( document.querySelector( '.lense.' + lense ) );
                myEl.addClass("brighten");
            };

            $scope.removeClass = function (lense){
                var myEl = angular.element( document.querySelector( '.lense.' + lense ) );
                myEl.removeClass("brighten");
            }
            
            // var audioSource = angular.element(document.querySelector('#buttonSound1'));
            var audio = new Audio("assets/button1.wav");
            function playSound(button) {
                var btnName = 'sound' + button;
                // this['sound' + button].play();
                // this[btnName].play();
                // var audio = angular.element( document.querySelector( '.lense.' + lense ) );
                // sound1.play(); // video.play()
                // var audio = new Audio("assets/button"+button+".wav");
                audio.src = "assets/button"+button+".wav";
                audio.play();

                var currentTime = 0;
                var segmentEnd = 0.035;
                audio.addEventListener('timeupdate', function (){
                    if (segmentEnd && audio.currentTime >= segmentEnd) {
                        audio.pause();
                    }   
                    console.log(audio.currentTime);
                }, false);
                
            }
            
            var playCount = 0;
            var playArray = [1,3,2,2,4,1,2,3,1,4,3,2,4,1];
            var buttonArray = ['green','red','blue','yellow'];
            var playSpeed = 550;
            var lastButton = null;
            $scope.simonSays = function(){
                playCount += 1; //Todo: remove this
                var c = 0;
                var interval = setInterval(function() { 
                    if (c > 0) $scope.removeClass(lastButton);
                    playAnimator(playArray[c]); 
                    c++; 
                    if(c >= playCount) {
                        clearInterval(interval);
                        $timeout(function(){
                            $scope.removeClass(lastButton);
                        }, 555);
                    };
                }, playSpeed); 
            };

            function playAnimator(btn) {
                var btnColor = buttonArray[btn-1];
                $scope.buttonPress(btnColor,btn);
                lastButton = btnColor;
            }
            
        });

        // var sound1 = document.getElementById("buttonSound1");
        // var sound2 = document.getElementById("buttonSound2");
        // var sound3 = document.getElementById("buttonSound3");
        // var sound4 = document.getElementById("buttonSound4");
        
        // function buttonPress(button,num) {
        //     playSound(num);
        //     lightButton(button);
        // }
        
        // var currentTime = 0;
        // var segmentEnd = 0.5;
        // sound1.addEventListener('timeupdate', function (){
        //     if (segmentEnd && sound1.currentTime >= segmentEnd) {
        //         sound1.pause();
        //     }   
        //     console.log(sound1.currentTime);
        // }, false);
        // sound2.addEventListener('timeupdate', function (){
        //     if (segmentEnd && sound2.currentTime >= segmentEnd) {
        //         sound2.pause();
        //     }   
        //     console.log(sound2.currentTime);
        // }, false);
        // sound3.addEventListener('timeupdate', function (){
        //     if (segmentEnd && sound3.currentTime >= segmentEnd) {
        //         sound3.pause();
        //     }   
        //     console.log(sound3.currentTime);
        // }, false);
        // sound4.addEventListener('timeupdate', function (){
        //     if (segmentEnd && sound4.currentTime >= segmentEnd) {
        //         sound4.pause();
        //     }   
        //     console.log(sound4.currentTime);
        // }, false);
        // function playSegment(startTime, endTime){
        //     segmentEnd = endTime;
        //     sound1.currentTime = startTime;
        //     sound1.play();
        // }
    </script>
</head>
<body ng-app="simonApp" ng-controller="myCtrl" >
    <div class="circle">
        <div class="circle inside">
            <div class="lense green"
                ng-mousedown="buttonPress('green',1);"
                ng-mouseup="removeClass('green')" ng-mouseout="removeClass('green')"></div>
            <div class="lense red"
                ng-mousedown="buttonPress('red',2);"
                ng-mouseup="removeClass('red')" ng-mouseout="removeClass('red')"></div>
            <div class="lense blue" 
                ng-mousedown="buttonPress('blue',3);"
                ng-mouseup="removeClass('blue')" ng-mouseout="removeClass('blue')"></div>
            <div class="lense yellow"
                ng-mousedown="buttonPress('yellow',4);"
                ng-mouseup="removeClass('yellow')" ng-mouseout="removeClass('yellow')"></div>
            <div class="circle controls"
                ng-click="gameStarted=true;simonSays();">
                <div class="start">Start</div>
            </div>

        </div>
    </div>

</body>
</html>



